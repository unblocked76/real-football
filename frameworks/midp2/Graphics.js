"use strict";var _p=window;var javax=_p.javax=_p.javax||{};var microedition=_p.javax.microedition=_p.javax.microedition||{};var lcdui=_p.javax.microedition.lcdui=_p.javax.microedition.lcdui||{};var Graphics=_p.javax.microedition.lcdui.Graphics=gloft.Class.extend({_className:"Graphics",ctor:function(a){if(typeof a=="undefined"){a=gloft.runtime.canvas}if(!(a instanceof HTMLCanvasElement)){throw new Error("Invalid parameter")}this.m_HTMLCanvasElement=a;this.m_CanvasRenderingContext2D=a.getContext("webgl-2d")||a.getContext("2d");this._setDefault();this._enableBatchRender=this.m_HTMLCanvasElement.enableBatchRender===true;this._renderNodes=[];this.m_HTMLCanvasElement.graphics=this;this._drawCount=0;this._lastDrawCall=0},_setDefault:function(){this.m_CanvasRenderingContext2D.globalAlpha=1;this.m_CanvasRenderingContext2D.lineWidth=1;this.m_ExtraData={color:0,clip:{x:0,y:0,width:-1,height:-1},};this.transportMidp2Image=javax.microedition.lcdui.Image.createImage(this.m_HTMLCanvasElement.width,this.m_HTMLCanvasElement.height)},_BuildClip:function(i){var e=this.getClipX();var d=this.getClipY();var h=this.getClipWidth();var g=this.getClipHeight();if(i.x+i.width<=e){return false}else{if(i.x>=e+h){return false}else{if(i.y+i.height<=d){return false}else{if(i.y>=d+g){return false}else{var c=Math.max(e,i.x);var b=Math.max(d,i.y);var f=Math.min(e+h,i.x+i.width);var a=Math.min(d+g,i.y+i.height);return{x:c,y:b,width:f-c,height:a-b}}}}}},_DrawImageAffineClip:function(q,a,N,c,u,g){var s={};var q=q;var n=(u==0&&(g==Graphics.ANCHOR_NONE||g==0));var G=this.getClipX();var A=this.getClipY();var L=G+this.getClipWidth();var r=A+this.getClipHeight();var J=c.x;var b=c.y;var I=J+c.width;var x=b+c.height;if(n&&I<=G){return false}else{if(n&&J>=L){return false}else{if(n&&x<=A){return false}else{if(n&&b>=r){return false}else{var d=false;var h=Graphics._getAnchorAdjustmentX(c.width,c.height,u,g);var f=Graphics._getAnchorAdjustmentY(c.width,c.height,u,g);var C;var M;var e;var k;c.x+=h;c.y+=f;var H;var z;var K;var v;var B=function(P,O,R){var Q=P;Q=Math.max(Q,O);Q=Math.min(Q,R);return Q};var t=((c.width)/2);var D=((c.height)/2);var p;var o;if(u<=Sprite.TRANS_ROT180){p=c.x+t;o=c.y+D}else{p=c.x+D;o=c.y+t}if(u==Sprite.TRANS_ROT270){C=o+t;e=o-t;M=p-D;k=p+D;H=B(C,A,r);K=B(e,A,r);z=B(M,G,L);v=B(k,G,L);s.x=Math.min(z,v);s.y=Math.min(H,K);s.width=Math.max(z,v)-s.x;s.height=Math.max(H,K)-s.y;var m=0+c.x;var l=c.width+c.y;if(q){q.save();d=true;q.translate(m,l);q.rotate(-Math.PI/2)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_MIRROR_ROT270){C=o-t;e=o+t;M=p-D;k=p+D;H=B(C,A,r);K=B(e,A,r);z=B(M,G,L);v=B(k,G,L);s.x=Math.min(z,v);s.y=Math.min(H,K);s.width=Math.max(z,v)-s.x;s.height=Math.max(H,K)-s.y;var m=c.x;var l=c.y;if(q){q.save();d=true;q.translate(m,l);q.rotate(-Math.PI/2);q.scale(-1,1)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_ROT90){C=o-t;e=o+t;M=p+D;k=p-D;H=B(C,A,r);K=B(e,A,r);z=B(M,G,L);v=B(k,G,L);s.x=Math.min(z,v);s.y=Math.min(H,K);s.width=Math.max(z,v)-s.x;s.height=Math.max(H,K)-s.y;var m=c.height+c.x;var l=0+c.y;if(q){q.save();d=true;q.translate(m,l);q.rotate(Math.PI/2)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_MIRROR_ROT90){C=o+t;e=o-t;M=p+D;k=p-D;H=B(C,A,r);K=B(e,A,r);z=B(M,G,L);v=B(k,G,L);s.x=Math.min(z,v);s.y=Math.min(H,K);s.width=Math.max(z,v)-s.x;s.height=Math.max(H,K)-s.y;var m=c.height+c.x;var l=c.width+c.y;if(q){q.save();d=true;q.translate(m,l);q.rotate(Math.PI/2);q.scale(-1,1)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_ROT180){C=p+t;e=p-t;M=o+D;k=o-D;H=B(C,G,L);K=B(e,G,L);z=B(M,A,r);v=B(k,A,r);s.x=Math.min(H,K);s.y=Math.min(z,v);s.width=Math.max(H,K)-s.x;s.height=Math.max(z,v)-s.y;var m=c.width+c.x;var l=c.height+c.y;if(q){q.save();d=true;q.translate(m,l);q.rotate(Math.PI)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_MIRROR){C=p+t;e=p-t;M=o-D;k=o+D;H=B(C,G,L);K=B(e,G,L);z=B(M,A,r);v=B(k,A,r);s.x=Math.min(H,K);s.y=Math.min(z,v);s.width=Math.max(H,K)-s.x;s.height=Math.max(z,v)-s.y;var m=c.width+c.x;var l=c.y;if(q){q.save();d=true;q.translate(m,l);q.scale(-1,1)}c.x=0;c.y=0}else{if(u==Sprite.TRANS_MIRROR_ROT180){C=p-t;e=p+t;M=o+D;k=o-D;H=B(C,G,L);K=B(e,G,L);z=B(M,A,r);v=B(k,A,r);s.x=Math.min(H,K);s.y=Math.min(z,v);s.width=Math.max(H,K)-s.x;s.height=Math.max(z,v)-s.y;var m=c.x;var l=c.height+c.y;if(q){q.save();d=true;q.translate(m,l);q.scale(1,-1)}c.x=0;c.y=0}else{C=p-t;e=p+t;M=o-D;k=o+D;H=B(C,G,L);K=B(e,G,L);z=B(M,A,r);v=B(k,A,r);s.x=Math.min(H,K);s.y=Math.min(z,v);s.width=Math.max(H,K)-s.x;s.height=Math.max(z,v)-s.y}}}}}}}var w=Math.abs(H-C)|0;var i=Math.abs(z-M)|0;var F=(Math.abs(K-e)+w)|0;var j=(Math.abs(v-k)+i)|0;var y={x:c.x+w,y:c.y+i,width:c.width-F,height:c.height-j};var E={x:N.x+w,y:N.y+i,width:y.width,height:y.height};if(y.width>0&&y.height>0){if(q){q.drawImage(a,E.x,E.y,E.width,E.height,y.x,y.y,y.width,y.height)}}if(d){q.restore()}return y.width>0&&y.height>0?s:false}}}}},getColor:function(){var a=(this.m_ExtraData.color<<8)>>>8;return a},getDisplayColor:function(a){return a},getClipX:function(){return this.m_ExtraData.clip.x|0},getClipY:function(){return this.m_ExtraData.clip.y|0},getClipWidth:function(){return this.m_ExtraData.clip.width!=-1?this.m_ExtraData.clip.width:this.m_HTMLCanvasElement.width},getClipHeight:function(){return this.m_ExtraData.clip.height!=-1?this.m_ExtraData.clip.height:this.m_HTMLCanvasElement.height},getTranslateX:function(){return(this.origin_x|0)},getTranslateY:function(){return(this.origin_y|0)},translate:function(a,b){this.origin_x=(this.origin_x|0)+a;this.origin_y=(this.origin_y|0)+b;if(this._enableBatchRender){this._renderNodes.push({type:"translate",x:a,y:b})}else{this.m_CanvasRenderingContext2D.translate(a,b)}},setClip:function(b,d,c,a){this.m_ExtraData.clip.x=b;this.m_ExtraData.clip.y=d;this.m_ExtraData.clip.width=c;this.m_ExtraData.clip.height=a;if(this._enableBatchRender){this._renderNodes.push({type:"setClip",x:b,y:d,width:c,height:a})}},setColor:function(e,d,c){var i;if(c!=undefined){var h=e;var f=d;var a=c;i=255<<24|(h&255)<<16|(f&255)<<8|(a&255)}else{i=(4278190080)|(e<<8)>>>8}if(this._enableBatchRender){this._renderNodes.push({type:"setColor",color:i})}else{this.m_ExtraData.color=i}},doApplyColor:function(){if(this.m_ExtraData.color!=this.m_ExtraData.currentColor){this.m_CanvasRenderingContext2D.fillStyle=this.m_CanvasRenderingContext2D.strokeStyle=Graphics._to_css_color(this.m_ExtraData.color);this.m_ExtraData.currentColor=this.m_ExtraData.color}},drawRegion:function(a,i,h,b,j,c,e,g,f){var d=this._DrawImageAffineClip(this._enableBatchRender?null:this.m_CanvasRenderingContext2D,a.getHTMLCanvasElement(),{x:i,y:h,width:b,height:j},{x:e,y:g,width:b,height:j},c,f);if(d){if(this._enableBatchRender){this._renderNodes.push({type:"drawRegion",src:a,x_src:i,y_src:h,width:b,height:j,transform:c,x_dest:e,y_dest:g,anchor:f,drawRegionInfo:d,})}else{this._callbackDraw()}}},drawImage:function(c,b,h,e){var d=Sprite.TRANS_NONE;var f=c.getWidth();var a=c.getHeight();var g=this._DrawImageAffineClip(this._enableBatchRender?null:this.m_CanvasRenderingContext2D,c.getHTMLCanvasElement(),{x:0,y:0,width:f,height:a},{x:b,y:h,width:f,height:a},d,e);if(g){if(this._enableBatchRender){this._renderNodes.push({type:"drawImage",img:c,x:b,y:h,anchor:e,drawRegionInfo:g,})}else{this._callbackDraw()}}},doDrawRGB:function(h,f,e,b,g,c,a,d){this.beginTransport(c,a);this.transportMidp2Image._setRGB(h,f,e,0,0,c,a,d);this.endTransport(false,b,g)},drawRGB:function(f,d,e,h,g,a,j,c){var b=this._DrawImageAffineClip(null,null,{x:0,y:0,width:a,height:j},{x:h,y:g,width:a,height:j},Sprite.TRANS_NONE,0);if(b){if(this._enableBatchRender){var i=[];System.arraycopy(f,0,i,0,f.length);this._renderNodes.push({type:"drawRGB",rgbData:i,offset:d,scanlength:e,x:h,y:g,width:a,height:j,processAlpha:c,drawRegionInfo:b,})}else{this.doDrawRGB(f,d,e,h,g,a,j,c);this._callbackDraw()}}},doDrawRect:function(b,e,c,a,d){this.doApplyColor();this.m_CanvasRenderingContext2D.beginPath();this.m_CanvasRenderingContext2D.rect(b,e,c,a);this.m_CanvasRenderingContext2D.closePath();if(d===true){this.m_CanvasRenderingContext2D.fill()}else{this.m_CanvasRenderingContext2D.stroke()}},drawRect:function(b,e,c,a){var d=this._BuildClip({x:b,y:e,width:c,height:a});if(d&&d.width>0&&d.height>0){if(this._enableBatchRender){this._renderNodes.push({type:"drawRect",x:d.x,y:d.y,width:d.width,height:d.height,})}else{this.doDrawRect(d.x,d.y,d.width,d.height,false);this._callbackDraw()}}},fillRect:function(b,e,c,a){var d=this._BuildClip({x:b,y:e,width:c,height:a});if(d&&d.width>0&&d.height>0){if(this._enableBatchRender){this._renderNodes.push({type:"fillRect",x:d.x,y:d.y,width:d.width,height:d.height,})}else{this.doDrawRect(d.x,d.y,d.width,d.height,true);this._callbackDraw()}}},doDrawArc:function(b,h,e,a,d,f,g){if(e<=0||a<=0){gloft.warn("negative # width/height = "+e+"/"+a);return}this.doApplyColor();var c=this.beginTransport(e,a);c.beginPath();c.ellipse(e/2,a/2,e/2,a/2,0*Math.PI/180,(d/180)*Math.PI,(f/180)*Math.PI);c.closePath();if(g===true){c.fill()}else{c.stroke()}this.endTransport(true,b,h)},drawArc:function(b,g,d,a,c,e,f){if(d<=0||a<=0){gloft.warn("negative # width/height = "+d+"/"+a);return}if(this._enableBatchRender){this._renderNodes.push({type:"drawArc",x:b,y:g,width:d,height:a,startAngle:c,arcAngle:e,})}else{this.doDrawArc(b,g,d,a,c,e,false);this._callbackDraw()}},fillArc:function(b,f,d,a,c,e){if(d<=0||a<=0){gloft.warn("negative # width/height = "+d+"/"+a);return}if(this._enableBatchRender){this._renderNodes.push({type:"fillArc",x:b,y:f,width:d,height:a,startAngle:c,arcAngle:e,})}else{this.ellipseFill(b,f,d,a,c,e);this._callbackDraw()}},ellipseFill:function(b,h,f,a,e,d){if(f<=0||a<=0){gloft.warn("negative # width/height = "+f+"/"+a);return}this.doApplyColor();var c=this.beginTransport(f,a);if(e>d){for(var g=(e/180)*Math.PI;g>(d/180)*Math.PI;g-=Math.PI/180){c.beginPath();c.moveTo(f/2,a/2);c.lineTo(f/2+Math.cos(g)*f/2,a/2+Math.sin(g)*a/2);c.lineWidth=3;c.stroke();c.closePath()}}else{for(var g=(e/180)*Math.PI;g<(d/180)*Math.PI;g+=Math.PI/180){c.beginPath();c.moveTo(f/2,a/2);c.lineTo(f/2+Math.cos(g)*f/2,a/2+Math.sin(g)*a/2);c.lineWidth=3;c.stroke();c.closePath()}}this.endTransport(true,b,h)},doDrawLine:function(b,d,a,c){this.doApplyColor();this.m_CanvasRenderingContext2D.save();var e=this.m_CanvasRenderingContext2D.lineWidth;var f=(e%2)/2;this.m_CanvasRenderingContext2D.translate(f,f);this.m_CanvasRenderingContext2D.beginPath();this.m_CanvasRenderingContext2D.moveTo(b,d);this.m_CanvasRenderingContext2D.lineTo(a,c);this.m_CanvasRenderingContext2D.closePath();this.m_CanvasRenderingContext2D.stroke();this.m_CanvasRenderingContext2D.restore()},drawLine:function(b,g,a,f){var i=Math.min(b,a);var e=Math.min(g,f);var j=Math.max(b,a)-i;var d=Math.max(g,f)-e;var c=this._BuildClip({x:i-0.5,y:e-0.5,width:j+1,height:d+1});if(!(c&&c.width>0&&c.height>0)){return}if(this._enableBatchRender){this._renderNodes.push({type:"drawLine",x1:b,y1:g,x2:a,y2:f,})}else{this.doDrawLine(b,g,a,f);this._callbackDraw()}},doFillTriangle:function(d,f,b,e,a,c){this.doApplyColor();this.m_CanvasRenderingContext2D.beginPath();this.m_CanvasRenderingContext2D.moveTo(d,f);this.m_CanvasRenderingContext2D.lineTo(b,e);this.m_CanvasRenderingContext2D.lineTo(a,c);this.m_CanvasRenderingContext2D.closePath();this.m_CanvasRenderingContext2D.fill()},fillTriangle:function(d,f,b,e,a,c){if(this._enableBatchRender){this._renderNodes.push({type:"fillTriangle",x1:d,y1:f,x2:b,y2:e,x3:a,y3:c,})}else{this.doFillTriangle(d,f,b,e,a,c);this._callbackDraw()}},drawString:function(h,j,i,f){throw new Error("TBC!");var b="normal";var c=16;var e="arial";this.beginTransport();var g=this.transportMidp2Image.getHTMLCanvasElement();var d=g.getContext("2d");d.font=[b,c+"px",e].join(" ");var a=d.measureText(h).width;if((f&Graphics.RIGHT)!=0){j-=a}else{if((f&Graphics.HCENTER)!=0){j-=a/2}}if((f&Graphics.BOTTOM)!=0){}else{if((f&Graphics.BASELINE)!=0){}else{d.textBaseline="top"}}d.beginPath();d.moveTo(this.getClipX(),this.getClipY());d.lineTo(this.getClipX()+this.getClipWidth(),this.getClipY());d.lineTo(this.getClipX()+this.getClipWidth(),this.getClipY()+this.getClipHeight());d.lineTo(this.getClipX(),this.getClipY()+this.getClipHeight());d.closePath();d.clip();d.fillText(h,j,i);this.endTransport(true,0,0)},beginTransport:function(a,b){if(a==undefined){a=this.m_HTMLCanvasElement.width}if(b==undefined){b=this.m_HTMLCanvasElement.height}var d=this.transportMidp2Image.getHTMLCanvasElement();if(a!=d.width){d.width=a}if(b!=d.height){d.height=b}var c=d.getContext("2d");c.save();c.clearRect(0,0,d.width,d.height);c.fillStyle=this.m_CanvasRenderingContext2D.fillStyle;c.strokeStyle=this.m_CanvasRenderingContext2D.strokeStyle;c.lineWidth=this.m_CanvasRenderingContext2D.lineWidth;return c},endTransport:function(e,c,b){if(e==undefined){e=true}if(c==undefined){c=0}if(b==undefined){b=0}var g=this.transportMidp2Image.getHTMLCanvasElement();var f=g.getContext("2d");f.restore();if(e){gloft.handleLoadedTexture(g)}var d=g.width;var a=g.height;this._DrawImageAffineClip(this.m_CanvasRenderingContext2D,g,{x:0,y:0,width:d,height:a},{x:c,y:b,width:d,height:a},Sprite.TRANS_NONE,0)},rendering:function(){var c=this._renderNodes;this.m_ExtraData.currentColor=0;this.m_ExtraData.color=16777215;var p=function(v,w){switch(v.type){case"drawImage":case"drawRegion":case"drawRGB":var i=undefined;if(v.type=="drawRGB"){i=v.processAlpha}else{if(v.type=="drawRegion"){i=v.src._hasAlpha}else{if(v.type=="drawImage"){i=v.img._hasAlpha}}}if(!w||i===false){var j=v.drawRegionInfo;return j}else{return false}case"fillRect":return{x:v.x,y:v.y,width:v.width,height:v.height};default:return false}};var a=0;for(var r=0,s=c.length;r<s;r++){var k=c[r];if(k.type=="setColor"){this.m_ExtraData.color=k.color}else{if(k.type=="setClip"){this.m_ExtraData.clip.x=k.x;this.m_ExtraData.clip.y=k.y;this.m_ExtraData.clip.width=k.width;this.m_ExtraData.clip.height=k.height}else{var l=true;var d=p(k,false);if(d){if(d.width*d.height<(this.m_HTMLCanvasElement.width*this.m_HTMLCanvasElement.height)*0.3){var b=[d];for(var q=r+1;q<s&&l;q++){var e=p(c[q],true);if(e){if(gloft.rectContainsRect(e,d)){l=false;a++}else{if(gloft.rectIntersectsRect(e,d)){var t=Graphics._checkDirty(b,e);if(t.length>20){throw new Error("check me")}if(t.length){b=t}else{l=false;a++}}}}}}}if(l){switch(k.type){case"drawImage":var u=k.img;var h=k.x;var g=k.y;var f=k.anchor;var m=Sprite.TRANS_NONE;var o=u.getWidth();var n=u.getHeight();this._DrawImageAffineClip(this.m_CanvasRenderingContext2D,u.getHTMLCanvasElement(),{x:0,y:0,width:o,height:n},{x:h,y:g,width:o,height:n},m,f);this._callbackDraw();break;case"drawRegion":this._DrawImageAffineClip(this.m_CanvasRenderingContext2D,k.src.getHTMLCanvasElement(),{x:k.x_src,y:k.y_src,width:k.width,height:k.height},{x:k.x_dest,y:k.y_dest,width:k.width,height:k.height},k.transform,k.anchor);this._callbackDraw();break;case"drawRGB":this.doDrawRGB(k.rgbData,k.offset,k.scanlength,k.x,k.y,k.width,k.height,k.processAlpha);this._callbackDraw();break;case"drawArc":case"fillArc":this.doDrawArc(k.x,k.y,k.width,k.height,k.startAngle,k.arcAngle,k.type=="fillArc");this._callbackDraw();case"fillTriangle":this.doFillTriangle(k.x1,k.y1,k.x2,k.y2,k.x3,k.y3);this._callbackDraw();break;case"drawLine":this.doDrawLine(k.x1,k.y1,k.x2,k.y2);this._callbackDraw();break;case"drawRect":case"fillRect":this.doDrawRect(k.x,k.y,k.width,k.height,k.type=="fillRect");this._callbackDraw();break;default:throw new Error("Wrong type: "+k.type)}}}}delete c[r]}this._overlapCount=a;this._renderNodes.length=0},_callbackDraw:function(){this._lastDrawCall=Date.now();this._drawCount++;gloft.g_NumberOfDraws++}});Graphics.HCENTER=1;Graphics.VCENTER=2;Graphics.LEFT=4;Graphics.RIGHT=8;Graphics.TOP=16;Graphics.BOTTOM=32;Graphics.ANCHOR_NONE=Graphics.TOP|Graphics.LEFT;Graphics.BASELINE=64;Graphics._to_css_color=function(i,h){var h=typeof h!="undefined"?h:!true;i>>>=0;var c=i&255,f=(i&65280)>>>8,e=(i&16711680)>>>16;if(h){var d=(((i&4278190080)>>>24)/255);return"rgba("+e+", "+f+", "+c+",  "+d+")"}else{return"rgb("+e+", "+f+", "+c+")"}};Graphics._getAnchorAdjustmentX=function(d,a,c,b){if(c<=Sprite.TRANS_ROT180){if((b&Graphics.HCENTER)!=0){return -(d>>1)}else{if((b&Graphics.RIGHT)!=0){return -d}}}else{if((b&Graphics.HCENTER)!=0){return -(a>>1)}else{if((b&Graphics.RIGHT)!=0){return -a}}}return 0};Graphics._getAnchorAdjustmentY=function(d,a,c,b){if(c<=Sprite.TRANS_ROT180){if((b&Graphics.VCENTER)!=0){return -(a>>1)}else{if((b&Graphics.BOTTOM)!=0){return -a}}}else{if((b&Graphics.VCENTER)!=0){return -(d>>1)}else{if((b&Graphics.BOTTOM)!=0){return -d}}}return 0};Graphics._checkDirty=function(l,b){var k=[];for(var g=0,j=l.length;g<j;g++){var c=l[g];if(gloft.rectContainsRect(b,c)){}else{if(gloft.rectIntersectsRect(b,c)){if(c.x<b.x){var m={x:c.x,y:c.y,width:b.x-c.x,height:c.height};if(m.width<=1||m.height<=1){}else{k.push(m)}}if(c.x+c.width>b.x+b.width){var f={x:b.x+b.width,y:c.y,width:(c.x+c.width)-(b.x+b.width),height:c.height};if(f.width<=1||f.height<=1){}else{k.push(f)}}if(c.y<b.y){var h=Math.min(c.x+c.width,b.x+b.width)-Math.max(c.x,b.x);if(h<0){throw new Error("?")}else{if(h>0){var e={x:Math.max(c.x,b.x),y:c.y,width:h,height:b.y-c.y};if(e.width<=1||e.height<=1){}else{k.push(e)}}}}if(c.y+c.height>b.y+b.height){var h=Math.min(c.x+c.width,b.x+b.width)-Math.max(c.x,b.x);if(h<0){throw new Error("?")}else{if(h>0){var a=(b.y+b.height);var d={x:Math.max(c.x,b.x),y:a,width:h,height:c.y+c.height-a};if(d.width<=1||d.height<=1){}else{k.push(d)}}}}}else{k.push(c)}}}return k};